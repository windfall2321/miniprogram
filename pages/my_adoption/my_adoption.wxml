<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container">
  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="header">
    <view class="title">æˆ‘çš„é¢†å…»ç®¡ç†</view>
    <view class="tabs">
      <view class="tab {{activeTab === 'myListings' ? 'active' : ''}}" 
            data-tab="myListings" 
            bindtap="handleTabChange">
        æˆ‘å‘å¸ƒçš„é¢†å…»
      </view>
      <view class="tab {{activeTab === 'receivedApplications' ? 'active' : ''}}" 
            data-tab="receivedApplications" 
            bindtap="handleTabChange">
        æˆ‘æ”¶åˆ°çš„ç”³è¯·
      </view>
      <view class="tab {{activeTab === 'myApplications' ? 'active' : ''}}" 
            data-tab="myApplications" 
            bindtap="handleTabChange">
        æˆ‘çš„ç”³è¯·
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­æç¤º -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="container">
    <!-- æˆ‘å‘å¸ƒçš„é¢†å…»åˆ—è¡¨ -->
    <block wx:if="{{activeTab === 'myListings'}}">
      <block wx:if="{{myListings.length > 0}}">
        <view class="card {{item.status === 'adopted' ? 'adopted' : ''}}" 
              wx:for="{{myListings}}" 
              wx:key="adoptionId">
          <image class="card-img" 
                 src="{{item.petImage}}" 
                 mode="aspectFill"
                 bindtap="previewImage"
                 data-url="{{item.petImage}}"/>
          <view class="card-info">
            <view class="card-header">
              <text class="title">{{item.petName || 'æœªå‘½åå® ç‰©'}}</text>
              <text class="status-tag {{item.status === 'available' ? 'success' : 'info'}}">
                {{item.status === 'available' ? 'å¯é¢†å…»' : 'å·²é¢†å…»'}}
              </text>
            </view>
            <text class="type">{{item.petBreed}}</text>
            <text class="description">{{item.description}}</text>
            <view class="details">
              <view class="detail-row">
                <view class="detail-item">
                  <text class="icon">ğŸ“</text>
                  <text class="label">åŸå¸‚</text>
                  <text>{{item.petCity || 'æœªçŸ¥'}}</text>
                </view>
                <view class="detail-item">
                  <text class="icon">ğŸ‘¤</text>
                  <text class="label">æ€§åˆ«</text>
                  <text>{{item.petGender === 1 ? 'å…¬' : 'æ¯'}}</text>
                </view>
              </view>
              <view class="detail-row">
                <view class="application-count" wx:if="{{item.applicationCount}}">
                  <text class="badge">{{item.applicationCount}}</text>
                  <text class="application-text">ç”³è¯·</text>
                </view>
              </view>
            </view>
            <view class="btn-area">
              <button class="apply-btn delete" 
                      data-id="{{item.adoptionId}}"
                      bindtap="handleDeleteListing">
                åˆ é™¤
              </button>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-data" wx:else>
        <text class="icon">ğŸ“</text>
        <text>æš‚æ— å‘å¸ƒçš„é¢†å…»ä¿¡æ¯</text>
      </view>
    </block>

    <!-- æˆ‘æ”¶åˆ°çš„ç”³è¯·åˆ—è¡¨ -->
    <block wx:if="{{activeTab === 'receivedApplications'}}">
      <block wx:if="{{receivedApplications.length > 0}}">
        <view class="card" wx:for="{{receivedApplications}}" wx:key="adoptionApplicationId">
          <view class="card-info">
            <view class="card-header">
              <text class="title">{{item.petName}}</text>
              <text class="status-tag {{getApplicationStatusType(item.status)}}">
                {{getApplicationStatusText(item.status)}}
              </text>
            </view>
            <text class="type">{{item.petType}}</text>
            <view class="description">
              <text class="description-label">ç”³è¯·ç†ç”±:</text>
              <text>{{item.reason}}</text>
            </view>
            <view class="btn-area" wx:if="{{item.status === 'pending'}}">
              <button class="apply-btn approve" 
                      data-id="{{item.adoptionApplicationId}}"
                      data-status="approved"
                      bindtap="handleApplicationStatus">
                åŒæ„
              </button>
              <button class="apply-btn reject" 
                      data-id="{{item.adoptionApplicationId}}"
                      data-status="rejected"
                      bindtap="handleApplicationStatus">
                æ‹’ç»
              </button>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-data" wx:else>
        <text class="icon">ğŸ“¨</text>
        <text>æš‚æ— æ”¶åˆ°çš„ç”³è¯·</text>
      </view>
    </block>

    <!-- æˆ‘çš„ç”³è¯·åˆ—è¡¨ -->
    <block wx:if="{{activeTab === 'myApplications'}}">
      <block wx:if="{{myApplications.length > 0}}">
        <view class="card" wx:for="{{myApplications}}" wx:key="adoptionApplicationId">
          <view class="card-info">
            <view class="card-header">
              <text class="title">{{item.petName}}</text>
              <text class="status-tag {{statusUtils.getStatusType(item.status)}}">
                {{statusUtils.getStatusText(item.status)}}
              </text>
            </view>
            <text class="type">{{item.petType}}</text>
            <view class="description">
              <text class="description-label">ç”³è¯·ç†ç”±:</text>
              <text>{{item.reason}}</text>
            </view>
            <view class="btn-area" wx:if="{{item.status === 'pending'}}">
              <button class="apply-btn cancel" 
                      data-id="{{item.adoptionApplicationId}}"
                      bindtap="handleCancelApplication">
                å–æ¶ˆç”³è¯·
              </button>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-data" wx:else>
        <text class="icon">ğŸ“‹</text>
        <text>æš‚æ— ç”³è¯·è®°å½•</text>
      </view>
    </block>
  </view>
</view>

<wxs module="statusUtils">
  function getStatusText(status) {
    var statusMap = {
      'pending': 'å¾…å®¡æ ¸',
      'approved': 'å·²é€šè¿‡',
      'rejected': 'å·²æ‹’ç»',
      'cancelled': 'å·²å–æ¶ˆ'
    }
    return statusMap[status] || 'æœªçŸ¥çŠ¶æ€'
  }

  function getStatusType(status) {
    var typeMap = {
      'pending': 'warning',
      'approved': 'success',
      'rejected': 'error',
      'cancelled': 'info'
    }
    return typeMap[status] || 'info'
  }

  module.exports = {
    getStatusText: getStatusText,
    getStatusType: getStatusType
  }
</wxs> 