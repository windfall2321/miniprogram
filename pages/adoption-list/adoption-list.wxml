<!-- è¡¨å¤´å’Œæœç´¢åŒºåŸŸ -->
<view class="header">
  <view class="title">é¢†å…»ä¸æ•‘åŠ©</view>
  <view class="search-container">
    <!-- æ·»åŠ æˆ‘çš„é¢†å…»ç®¡ç†æŒ‰é’® -->
    <view class="my-adoption-btn" bindtap="navigateToMyAdoption">
      <text class="icon">ğŸ“‹</text>
      <text>æˆ‘çš„é¢†å…»ç®¡ç†</text>
    </view>
    <input 
      class="search-input" 
      placeholder="è¯·è¾“å…¥å® ç‰©åç§°" 
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
      bindconfirm="handleSearch"
    />
    <view class="btn-group">
      <view class="search-btn" bindtap="handleSearch">æœç´¢</view>
      <view class="reset-btn" bindtap="handleReset">é‡ç½®</view>
    </view>
  </view>
</view>

<view class="container">
  <block wx:for="{{adoptions}}" wx:key="adoptionId">
    <view class="card">
      <image class="card-img" src="{{item.image}}" mode="aspectFill" />
      <view class="card-info">
        <view class="card-header">
          <text class="title">{{item.petName}}</text>
          <text class="status-tag {{item.status === 'available' ? 'success' : 'info'}}">
            {{item.status === 'available' ? 'å¯é¢†å…»' : 'å·²é¢†å…»'}}
          </text>
        </view>
        <text class="description">{{item.description}}</text>
        <view class="btn-area">
          <button class="apply-btn detail {{item.status !== 'available' ? 'disabled' : ''}}" 
                  bindtap="apply" 
                  data-id="{{item.adoptionId}}"
                  disabled="{{item.status !== 'available'}}">è¯¦æƒ…</button>
          <button class="apply-btn request {{item.status !== 'available' ? 'disabled' : ''}}" 
                  bindtap="showApplicationModal" 
                  data-id="{{item.adoptionId}}"
                  disabled="{{item.status !== 'available'}}">ç”³è¯·</button>
        </view>
      </view>
    </view>
  </block>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="floating-btn" bindtap="goToAddAdoption">
    <text class="plus">ï¼‹</text>
  </view>
</view>
<!-- è‡ªå®šä¹‰å¼¹çª— -->
<view wx:if="{{showModal}}" class="modal-mask">
  <view class="modal-box">
    <view class="modal-header">
      <text class="modal-title">{{selectedPet.petName}}</text>
      <text class="modal-close" bindtap="closeModal">âœ•</text>
    </view>
    <image class="modal-image" src="{{selectedPet.image}}" mode="aspectFill" />
    <view class="modal-content">
      <text>å“ç§ï¼š{{selectedPet.petBreed}}</text>
      <text>æ€§åˆ«ï¼š{{selectedPet.petGender === 'male' ? 'å…¬' : 'æ¯'}}</text>
      <text>åŸå¸‚ï¼š{{selectedPet.petCity}}</text>
      <text>æè¿°ï¼š{{selectedPet.description}}</text>
      <!-- ç”³è¯·å¼¹çª—ç‰¹æœ‰å†…å®¹ -->
      <block wx:if="{{modalType === 'application'}}">
        <view class="reason-input">
          <text class="reason-label">ç”³è¯·ç†ç”±ï¼š</text>
          <textarea 
            class="reason-textarea" 
            placeholder="è¯·è¾“å…¥ç”³è¯·ç†ç”±ï¼ˆè‡³å°‘10ä¸ªå­—ï¼‰" 
            value="{{applicationReason}}"
            bindinput="onReasonInput"
            maxlength="200"
          ></textarea>
          <text class="word-count">{{reasonLength}}/200</text>
        </view>
      </block>
    </view>
    <!-- ç”³è¯·å¼¹çª—ç‰¹æœ‰æŒ‰é’® -->
    <view class="modal-footer" wx:if="{{modalType === 'application'}}">
      <button class="modal-btn cancel" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm" 
              bindtap="submitApplication" 
              data-id="{{selectedPet.adoptionId}}"
              disabled="{{!applicationReason || reasonLength < 10}}">
        æäº¤ç”³è¯·
      </button>
    </view>
  </view>
</view>